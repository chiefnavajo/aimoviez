
> aimoviez-app@0.1.0 test:integration
> jest --config jest.integration.config.js

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    
    âš¡ Concurrent Voting Results (1000 simultaneous):

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:249:15)

  console.log
       Total time: 1008ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:250:15)

  console.log
       Successful votes: 245

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:251:15)

  console.log
       Failed votes: 755

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:252:15)

  console.log
       Success rate: 24.5%

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:253:15)

  console.log
       Avg vote duration: 462.05ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:254:15)

  console.log
       Min vote duration: 145ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:255:15)

  console.log
       Max vote duration: 1012ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:256:15)

  console.log
       Error breakdown: { 'TypeError: fetch failed': 755 }

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:264:17)

  console.log
       â„¹ï¸  Note: "fetch failed" errors indicate connection pool exhaustion

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:265:17)

  console.log
       â„¹ï¸  This is expected behavior - use wave voting for better results

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:266:17)

  console.log
    
    ğŸ“Š Vote Distribution:

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:294:15)

  console.log
       Total votes recorded: 245

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:295:15)

  console.log
       Per clip: {
      a428421b: 54,
      f71c43b7: 53,
      '9340c948': 47,
      '6bed5422': 46,
      b46acd8e: 45
    }

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:296:15)

  console.log
       Duplicate votes detected: 0

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:329:15)

  console.log
    
    ğŸŒŠ Wave Voting Results:

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:371:15)

  console.log
       Wave 1: 100/100 successful in 158ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:373:17)

  console.log
       Wave 2: 100/100 successful in 180ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:373:17)

  console.log
       Wave 3: 100/100 successful in 188ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:373:17)

  console.log
       Wave 4: 100/100 successful in 282ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:373:17)

  console.log
       Wave 5: 100/100 successful in 212ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:373:17)

  console.log
       Wave 6: 100/100 successful in 167ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:373:17)

  console.log
       Wave 7: 100/100 successful in 217ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:373:17)

  console.log
       Wave 8: 100/100 successful in 198ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:373:17)

  console.log
       Wave 9: 100/100 successful in 194ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:373:17)

  console.log
       Wave 10: 100/100 successful in 217ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:373:17)

  console.log
       Total votes after waves: 1000

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:390:15)

  console.log
    
    ğŸ¯ Single Clip Stress Test (500 concurrent):

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:421:15)

  console.log
       Duration: 622ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:422:15)

  console.log
       Successful: 250

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:423:15)

  console.log
       Failed: 250

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:424:15)

  console.log
       Success rate: 50.0%

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:425:15)

  console.log
       Actual votes on clip: 250

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:433:15)

  console.log
       â„¹ï¸  Database accurately recorded all successful votes

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:434:15)

  console.log
    
    ğŸ” Race Condition Check:

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:477:15)

  console.log
       Expected successful: 200

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:478:15)

  console.log
       Actual in database: 200

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:479:15)

  console.log
       Lost votes: 0

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:480:15)

  console.log
       Votes are in chronological order: true

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:516:15)

  console.log
    
    ğŸ“ˆ Performance Metrics:

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:547:15)

  console.log
       Sequential (100 votes):

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:548:15)

  console.log
         Duration: 232ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:549:15)

  console.log
         Throughput: 431.03 votes/sec

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:550:15)

  console.log
       Parallel (100 votes):

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:551:15)

  console.log
         Duration: 151ms

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:552:15)

  console.log
         Throughput: 662.25 votes/sec

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:553:15)

  console.log
       Speedup: 1.54x

      at Object.<anonymous> (src/__tests__/integration/admin/concurrent-voting.test.ts:554:15)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/concurrent-voting.test.ts (6.302 s)
  Concurrent Voting Stress Test
    Setup Verification
      âœ“ created 1000 users for voting (1 ms)
      âœ“ created 5 clips to vote on
      âœ“ slot is in voting status (3 ms)
    Simultaneous Voting - All at Once
      âœ“ 1000 users vote at the exact same time (1030 ms)
      âœ“ vote counts are accurate after concurrent voting (6 ms)
      âœ“ no duplicate votes from same voter (4 ms)
    Wave Voting - Bursts of Users
      âœ“ 10 waves of 100 users voting rapidly (2020 ms)
      âœ“ total votes match expected after waves (6 ms)
    Stress Test - Rapid Fire Single Clip
      âœ“ 500 users vote for the same clip simultaneously (629 ms)
    Race Condition Detection
      âœ“ detects if votes are lost under heavy load (387 ms)
      âœ“ vote order is preserved (FIFO check) (216 ms)
    Performance Metrics
      âœ“ measures database throughput (446 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/multi-season.test.ts
  Multi-Season Operations (8 Seasons)
    Season Isolation
      âœ“ 8 seasons created independently with correct structure (19 ms)
      âœ“ clips in season 1 do not appear in season 2-8 (33 ms)
      âœ“ slot operations in one season do not affect others (28 ms)
      âœ“ winner in season 1 does not lock season 2-8 slots (33 ms)
    Parallel Upload Operations
      âœ“ upload clip to each of 8 seasons simultaneously (26 ms)
      âœ“ approve clips in all 8 seasons maintains independent slot status (41 ms)
      âœ“ timers run independently per season (74 ms)
    Parallel Delete Operations
      âœ“ delete clips from season 1 while seasons 2-8 continue (26 ms)
      âœ“ bulk delete across multiple seasons simultaneously (82 ms)
      âœ“ deleting last clip in season 1 does not affect season 2-8 timers (37 ms)
    Parallel Winner Operations
      âœ“ assign winner in season 1 while seasons 2-8 are voting (45 ms)
      âœ“ lock season 1 slot 1 does not affect season 2-8 slot 1 (31 ms)
    Mixed Operations Across Seasons
      âœ“ different operations in each season simultaneously (71 ms)
      âœ“ all 8 seasons at different stages simultaneously (364 ms)
    Season Status Combinations
      âœ“ operations only work on active seasons (26 ms)
      âœ“ mixed status seasons do not interfere (22 ms)
    Stress Test: Rapid Multi-Season Operations
      âœ“ 100 clips across 8 seasons with random distribution (408 ms)
      âœ“ parallel random operations across all seasons (65 ms)
      âœ“ verify data integrity after stress operations (31 ms)
    Cross-Season Data Integrity
      âœ“ season IDs never leak across boundaries (20 ms)
      âœ“ slot positions are independent per season (55 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/edge-cases.test.ts
  Edge Cases Tests
    Empty Season Scenarios
      âœ“ season with zero clips is valid (7 ms)
      âœ“ all slots remain in initial state with no clips (8 ms)
      âœ“ deleting all clips returns season to empty state (11 ms)
    Maximum Clips Scenarios
      âœ“ can create 100 clips in a single slot (235 ms)
      âœ“ can query slot with many clips efficiently (3 ms)
      âœ“ can count votes across many clips (195 ms)
    Special Characters in Data
      âœ“ handles Unicode characters in title (6 ms)
      âœ“ handles emoji in title (6 ms)
      âœ“ handles HTML/script tags in title (stored as-is) (4 ms)
      âœ“ handles SQL injection attempt in title (6 ms)
      âœ“ handles newlines and tabs in description (6 ms)
      âœ“ handles null bytes in title (3 ms)
    Slot Position Edge Cases
      âœ“ clips can exist without slot assignment (4 ms)
      âœ“ multiple clips in same slot coexist (9 ms)
      âœ“ clip can move between slots (6 ms)
      âœ“ removing slot assignment works (6 ms)
    Timing Edge Cases
      âœ“ rapid create-update-delete sequence (8 ms)
      âœ“ simultaneous create operations (10 ms)
    Season State Edge Cases
      âœ“ finished season still allows reads (9 ms)
      âœ“ draft season clips are accessible (7 ms)
      âœ“ season with all slots locked (11 ms)
    Data Consistency Checks
      âœ“ clip count matches database count (6 ms)
      âœ“ slot count matches total_slots in season (9 ms)
      âœ“ winner clip exists in slot clips (7 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    
    ğŸ“Š Load Test Statistics:

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:539:15)

  console.log
       Total Users: 1000

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:540:15)

  console.log
       Users Who Uploaded: 350

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:541:15)

  console.log
       Total Clips: 650

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:542:15)

  console.log
       Total Votes: 750

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:543:15)

  console.log
       Clips per Season: { '992558a1': 153, '14d95434': 201, '7fcb7446': 145, '3d5bb7b0': 151 }

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:544:15)

  console.log
       Query performance: 8 parallel queries in 9ms

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:564:15)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/load-test-1000-users.test.ts
  Load Test: 1000 Users Simulation
    User Creation
      âœ“ creates 1000 unique users successfully
      âœ“ all users exist in database (3 ms)
    Mass Upload Simulation
      âœ“ 300 users upload 2 clips each (600 total clips) (97 ms)
      âœ“ clips are properly distributed across 4 seasons (19 ms)
      âœ“ each user has exactly 2 clips (31 ms)
    Admin Approval Flow
      âœ“ admin approves 100 clips for voting in season 1 (26 ms)
      âœ“ slot status changes to voting (2 ms)
    Mass Voting Simulation
      âœ“ 700 users vote on active clips (249 ms)
      âœ“ votes are distributed across clips (4 ms)
      âœ“ can identify winning clip by vote count (5 ms)
    Concurrent Operations
      âœ“ simultaneous uploads and votes across seasons (22 ms)
      âœ“ database maintains integrity under concurrent load (60 ms)
    Statistics & Reporting
      âœ“ generates accurate user activity report (84 ms)
      âœ“ system handles 1000 users without performance degradation (9 ms)
    Edge Cases with High User Count
      âœ“ handles user voting for their own clip (5 ms)
      âœ“ handles duplicate vote attempts gracefully (5 ms)
      âœ“ handles max clips per user limit (2 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/error-scenarios.test.ts
  Error Scenarios Tests
    Invalid Data Handling
      âœ“ rejects clip with missing required title (2 ms)
      âœ“ rejects clip with invalid status value (2 ms)
      âœ“ rejects clip with invalid UUID for season_id (2 ms)
      âœ“ rejects clip with non-existent season_id (2 ms)
      âœ“ rejects clip with non-existent user_id (2 ms)
      âœ“ rejects slot with invalid status (1 ms)
      âœ“ rejects negative slot_position (2 ms)
      âœ“ rejects empty string for required fields (2 ms)
    Constraint Violations
      âœ“ handles duplicate vote from same voter gracefully (10 ms)
      âœ“ cannot set winner to non-existent clip (4 ms)
      âœ“ cannot delete season with existing clips (4 ms)
    State Transition Errors
      âœ“ cannot lock slot without winner (11 ms)
      âœ“ deleting winner clip should fail or update slot (9 ms)
    Concurrent Modification Errors
      âœ“ handles simultaneous updates to same clip (9 ms)
      âœ“ handles simultaneous status transitions (8 ms)
    Data Type Errors
      âœ“ handles very long title (2 ms)
      âœ“ handles special characters in title (2 ms)
      âœ“ handles null in optional fields (3 ms)
      âœ“ handles invalid URL format (2 ms)
    Boundary Conditions
      âœ“ slot_position at boundary (0) (2 ms)
      âœ“ slot_position at max int (2 ms)
      âœ“ vote_weight at minimum (1) (8 ms)
      âœ“ vote_weight at maximum (200) (8 ms)
      âœ“ vote_weight over maximum (201) is handled (7 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/timer-expiration.test.ts
  Timer Expiration Tests
    Timer States
      âœ“ can set voting timer to past (expired state) (6 ms)
      âœ“ can set voting timer to future (active state) (6 ms)
      âœ“ timer with exactly 0 seconds remaining (6 ms)
    Winner Determination on Expiration
      âœ“ clip with most votes should win when timer expires (266 ms)
      âœ“ handles tie-breaker scenario (earliest upload wins) (209 ms)
      âœ“ handles single clip scenario (auto-win) (44 ms)
      âœ“ handles zero votes scenario (31 ms)
    Timer Edge Cases
      âœ“ very long timer (30 days) (7 ms)
      âœ“ very short timer (1 minute) (6 ms)
      âœ“ timer already expired by 7 days (6 ms)
      âœ“ null timer values are handled (3 ms)
    Slot Transitions on Timer Events
      âœ“ slot should transition from voting to locked when winner assigned (42 ms)
      âœ“ next slot should become waiting_for_clips after current locks (24 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/operation-combinations.test.ts
  Operation Combinations
    Upload Combinations
      âœ“ upload â†’ delete (never approved) (15 ms)
      âœ“ upload â†’ approve â†’ delete (22 ms)
      âœ“ upload â†’ reject â†’ delete (14 ms)
      âœ“ upload â†’ approve â†’ reject â†’ reapprove (17 ms)
    Winner Combinations
      âœ“ approve â†’ winner â†’ unlock â†’ delete (30 ms)
      âœ“ approve â†’ winner â†’ unlock â†’ re-approve â†’ winner again (27 ms)
      âœ“ two clips â†’ winner clip1 â†’ unlock â†’ winner clip2 (37 ms)
    Edit Combinations
      âœ“ upload â†’ edit title â†’ approve (15 ms)
      âœ“ approve â†’ edit â†’ still active (16 ms)
      âœ“ locked clip cannot be edited (guard check) (11 ms)
    Slot Status Combinations
      âœ“ waiting_for_clips â†’ voting â†’ waiting_for_clips (all deleted) (16 ms)
      âœ“ voting â†’ locked â†’ voting (unlock) (21 ms)
      âœ“ slot 1 locked â†’ slot 2 becomes waiting_for_clips (21 ms)
    Bulk Operation Combinations
      âœ“ bulk approve multiple clips (23 ms)
      âœ“ bulk delete all â†’ slot resets (35 ms)
      âœ“ bulk reject does not affect other clips (25 ms)
    Edge Case Combinations
      âœ“ delete winner â†’ blocked, unlock â†’ delete â†’ success (19 ms)
      âœ“ multiple operations on same clip rapid succession (26 ms)
      âœ“ all clips rejected â†’ slot stays waiting (no active clips) (18 ms)
      âœ“ mixed statuses in slot: active + pending + rejected (21 ms)
      âœ“ unlock â†’ edit â†’ re-lock with same clip (24 ms)
    Timer Combinations
      âœ“ timer starts â†’ all clips deleted â†’ timer clears (30 ms)
      âœ“ timer running â†’ add more clips â†’ timer continues (15 ms)
      âœ“ timer running â†’ winner assigned â†’ timer preserved in lock (21 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/clip-lifecycle.test.ts
  Clip Lifecycle
    Basic Clip Creation
      âœ“ creates a pending clip successfully (21 ms)
      âœ“ creates multiple clips with unique IDs (9 ms)
    Approve Flow
      âœ“ approving a clip assigns it to the first available slot (23 ms)
      âœ“ approving first clip starts the 24h timer (12 ms)
    Winner Assignment
      âœ“ assigning winner locks the clip and slot (14 ms)
      âœ“ assigning winner advances to next slot (16 ms)
    Unlock Flow
      âœ“ unlocking a slot reverts clip status to pending (13 ms)
    Delete Flow - THE BUG WE FIXED
      âœ“ deleting last clip after unlock resets slot to waiting_for_clips (30 ms)
      âœ“ deleting last active clip clears timer (20 ms)
      âœ“ deleting one of multiple clips does NOT reset slot (20 ms)
    Safety Checks
      âœ“ cannot delete a clip that is the slot winner (10 ms)
      âœ“ cannot edit a locked clip status (9 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/slot-management.test.ts
  Slot Management
    Timer Management
      âœ“ approving first clip starts 24h timer (12 ms)
      âœ“ bulk delete all clips resets slot to waiting_for_clips (37 ms)
      âœ“ deleting pending clips also resets slot (20 ms)
    Status Transitions
      âœ“ slot transitions: upcoming -> waiting_for_clips -> voting -> locked (21 ms)
      âœ“ unlocking slot clears winner reference (21 ms)
    Edge Cases
      âœ“ slot with mixed active and pending clips stays in voting (19 ms)
      âœ“ rejected clips do not count towards slot status (18 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/safety-checks.test.ts
  Safety Checks
    Winner Protection
      âœ“ winner clip is linked to slot via winner_tournament_clip_id (9 ms)
      âœ“ can detect if clip is a winner before delete (10 ms)
      âœ“ non-winner clips can be deleted (11 ms)
    Locked Clip Guards
      âœ“ locked clip has status = locked (7 ms)
      âœ“ can detect locked clip before edit (8 ms)
      âœ“ unlocked clip can be edited (12 ms)
    Unlock Before Modify
      âœ“ unlocking slot clears winner and allows modification (16 ms)
      âœ“ attempting to modify locked slot winner fails safety check (9 ms)
    Bulk Operation Safety
      âœ“ bulk delete should skip winner clips (16 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/api-endpoints.test.ts
  API Endpoints Tests
    Health Check
      âœ“ API server is reachable (2 ms)
    Clips API - GET
      âœ“ GET /api/admin/clips returns clips list (4 ms)
      âœ“ GET /api/admin/clips/:id returns single clip (3 ms)
      âœ“ GET /api/admin/clips/:id with invalid UUID returns 400 or 404 (1 ms)
      âœ“ GET /api/admin/clips/:id with non-existent ID returns 404 (1 ms)
    Clips API - POST/PUT
      âœ“ POST to approve clip endpoint (3 ms)
      âœ“ POST to reject clip endpoint (4 ms)
      âœ“ PUT to update clip (3 ms)
    Clips API - DELETE
      âœ“ DELETE /api/admin/clips/:id removes clip (4 ms)
      âœ“ DELETE with non-existent ID returns 404
    Slots API
      âœ“ GET /api/admin/slots returns slots list (1 ms)
      âœ“ GET /api/admin/slots/:position returns single slot (1 ms)
      âœ“ POST /api/admin/slots/:position/unlock unlocks slot
    Seasons API
      âœ“ GET /api/admin/seasons returns seasons list (1 ms)
      âœ“ GET /api/admin/seasons/:id returns single season
    Response Format Validation
      âœ“ error responses have consistent format (1 ms)
      âœ“ success responses return JSON (1 ms)
    HTTP Methods
      âœ“ OPTIONS request returns allowed methods
      âœ“ HEAD request works for GET endpoints (1 ms)
      âœ“ unsupported method returns 405 (1 ms)
    Query Parameters
      âœ“ GET with query params for filtering
      âœ“ GET with pagination params (1 ms)
      âœ“ GET with status filter
    Content-Type Handling
      âœ“ accepts application/json (3 ms)
      âœ“ rejects invalid content-type for POST (3 ms)
    Rate Limiting Check
      âœ“ multiple rapid requests are handled (3 ms)

Test Suites: 11 passed, 11 total
Tests:       189 passed, 189 total
Snapshots:   0 total
Time:        12.83 s, estimated 14 s
Ran all test suites.
