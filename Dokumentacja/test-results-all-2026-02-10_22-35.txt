
> aimoviez-app@0.1.0 test:integration
> jest --config jest.integration.config.js

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/multi-season.test.ts
  Multi-Season Operations (8 Seasons)
    Season Isolation
      âœ“ 8 seasons created independently with correct structure (53 ms)
      âœ“ clips in season 1 do not appear in season 2-8 (78 ms)
      âœ“ slot operations in one season do not affect others (68 ms)
      âœ“ winner in season 1 does not lock season 2-8 slots (67 ms)
    Parallel Upload Operations
      âœ“ upload clip to each of 8 seasons simultaneously (55 ms)
      âœ“ approve clips in all 8 seasons maintains independent slot status (50 ms)
      âœ“ timers run independently per season (134 ms)
    Parallel Delete Operations
      âœ“ delete clips from season 1 while seasons 2-8 continue (45 ms)
      âœ“ bulk delete across multiple seasons simultaneously (131 ms)
      âœ“ deleting last clip in season 1 does not affect season 2-8 timers (43 ms)
    Parallel Winner Operations
      âœ“ assign winner in season 1 while seasons 2-8 are voting (54 ms)
      âœ“ lock season 1 slot 1 does not affect season 2-8 slot 1 (31 ms)
    Mixed Operations Across Seasons
      âœ“ different operations in each season simultaneously (90 ms)
      âœ“ all 8 seasons at different stages simultaneously (447 ms)
    Season Status Combinations
      âœ“ operations only work on active seasons (28 ms)
      âœ“ mixed status seasons do not interfere (21 ms)
    Stress Test: Rapid Multi-Season Operations
      âœ“ 100 clips across 8 seasons with random distribution (340 ms)
      âœ“ parallel random operations across all seasons (54 ms)
      âœ“ verify data integrity after stress operations (33 ms)
    Cross-Season Data Integrity
      âœ“ season IDs never leak across boundaries (21 ms)
      âœ“ slot positions are independent per season (44 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    
    ðŸ“Š Load Test Statistics:

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:539:15)

  console.log
       Total Users: 1000

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:540:15)

  console.log
       Users Who Uploaded: 350

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:541:15)

  console.log
       Total Clips: 650

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:542:15)

  console.log
       Total Votes: 750

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:543:15)

  console.log
       Clips per Season: { '7ccf685b': 142, '6a561f60': 205, '9f86c2cf': 160, f10adcf7: 143 }

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:544:15)

  console.log
       Query performance: 8 parallel queries in 8ms

      at Object.<anonymous> (src/__tests__/integration/admin/load-test-1000-users.test.ts:564:15)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/load-test-1000-users.test.ts
  Load Test: 1000 Users Simulation
    User Creation
      âœ“ creates 1000 unique users successfully
      âœ“ all users exist in database (3 ms)
    Mass Upload Simulation
      âœ“ 300 users upload 2 clips each (600 total clips) (81 ms)
      âœ“ clips are properly distributed across 4 seasons (19 ms)
      âœ“ each user has exactly 2 clips (26 ms)
    Admin Approval Flow
      âœ“ admin approves 100 clips for voting in season 1 (26 ms)
      âœ“ slot status changes to voting (2 ms)
    Mass Voting Simulation
      âœ“ 700 users vote on active clips (181 ms)
      âœ“ votes are distributed across clips (5 ms)
      âœ“ can identify winning clip by vote count (4 ms)
    Concurrent Operations
      âœ“ simultaneous uploads and votes across seasons (14 ms)
      âœ“ database maintains integrity under concurrent load (66 ms)
    Statistics & Reporting
      âœ“ generates accurate user activity report (82 ms)
      âœ“ system handles 1000 users without performance degradation (9 ms)
    Edge Cases with High User Count
      âœ“ handles user voting for their own clip (5 ms)
      âœ“ handles duplicate vote attempts gracefully (7 ms)
      âœ“ handles max clips per user limit (4 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/operation-combinations.test.ts
  Operation Combinations
    Upload Combinations
      âœ“ upload â†’ delete (never approved) (15 ms)
      âœ“ upload â†’ approve â†’ delete (22 ms)
      âœ“ upload â†’ reject â†’ delete (14 ms)
      âœ“ upload â†’ approve â†’ reject â†’ reapprove (17 ms)
    Winner Combinations
      âœ“ approve â†’ winner â†’ unlock â†’ delete (34 ms)
      âœ“ approve â†’ winner â†’ unlock â†’ re-approve â†’ winner again (24 ms)
      âœ“ two clips â†’ winner clip1 â†’ unlock â†’ winner clip2 (36 ms)
    Edit Combinations
      âœ“ upload â†’ edit title â†’ approve (16 ms)
      âœ“ approve â†’ edit â†’ still active (20 ms)
      âœ“ locked clip cannot be edited (guard check) (13 ms)
    Slot Status Combinations
      âœ“ waiting_for_clips â†’ voting â†’ waiting_for_clips (all deleted) (18 ms)
      âœ“ voting â†’ locked â†’ voting (unlock) (21 ms)
      âœ“ slot 1 locked â†’ slot 2 becomes waiting_for_clips (22 ms)
    Bulk Operation Combinations
      âœ“ bulk approve multiple clips (23 ms)
      âœ“ bulk delete all â†’ slot resets (23 ms)
      âœ“ bulk reject does not affect other clips (21 ms)
    Edge Case Combinations
      âœ“ delete winner â†’ blocked, unlock â†’ delete â†’ success (23 ms)
      âœ“ multiple operations on same clip rapid succession (21 ms)
      âœ“ all clips rejected â†’ slot stays waiting (no active clips) (21 ms)
      âœ“ mixed statuses in slot: active + pending + rejected (20 ms)
      âœ“ unlock â†’ edit â†’ re-lock with same clip (23 ms)
    Timer Combinations
      âœ“ timer starts â†’ all clips deleted â†’ timer clears (16 ms)
      âœ“ timer running â†’ add more clips â†’ timer continues (18 ms)
      âœ“ timer running â†’ winner assigned â†’ timer preserved in lock (17 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/clip-lifecycle.test.ts
  Clip Lifecycle
    Basic Clip Creation
      âœ“ creates a pending clip successfully (5 ms)
      âœ“ creates multiple clips with unique IDs (7 ms)
    Approve Flow
      âœ“ approving a clip assigns it to the first available slot (12 ms)
      âœ“ approving first clip starts the 24h timer (11 ms)
    Winner Assignment
      âœ“ assigning winner locks the clip and slot (17 ms)
      âœ“ assigning winner advances to next slot (18 ms)
    Unlock Flow
      âœ“ unlocking a slot reverts clip status to pending (15 ms)
    Delete Flow - THE BUG WE FIXED
      âœ“ deleting last clip after unlock resets slot to waiting_for_clips (26 ms)
      âœ“ deleting last active clip clears timer (17 ms)
      âœ“ deleting one of multiple clips does NOT reset slot (17 ms)
    Safety Checks
      âœ“ cannot delete a clip that is the slot winner (10 ms)
      âœ“ cannot edit a locked clip status (8 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/safety-checks.test.ts
  Safety Checks
    Winner Protection
      âœ“ winner clip is linked to slot via winner_tournament_clip_id (9 ms)
      âœ“ can detect if clip is a winner before delete (12 ms)
      âœ“ non-winner clips can be deleted (11 ms)
    Locked Clip Guards
      âœ“ locked clip has status = locked (8 ms)
      âœ“ can detect locked clip before edit (10 ms)
      âœ“ unlocked clip can be edited (10 ms)
    Unlock Before Modify
      âœ“ unlocking slot clears winner and allows modification (17 ms)
      âœ“ attempting to modify locked slot winner fails safety check (11 ms)
    Bulk Operation Safety
      âœ“ bulk delete should skip winner clips (18 ms)

  console.log
    Integration tests starting...

      at Object.<anonymous> (jest.integration.setup.ts:30:11)

  console.log
    Supabase URL: http://localhost:54321

      at Object.<anonymous> (jest.integration.setup.ts:31:11)

  console.log
    Integration tests complete.

      at Object.<anonymous> (jest.integration.setup.ts:35:11)

PASS integration src/__tests__/integration/admin/slot-management.test.ts
  Slot Management
    Timer Management
      âœ“ approving first clip starts 24h timer (13 ms)
      âœ“ bulk delete all clips resets slot to waiting_for_clips (33 ms)
      âœ“ deleting pending clips also resets slot (17 ms)
    Status Transitions
      âœ“ slot transitions: upcoming -> waiting_for_clips -> voting -> locked (23 ms)
      âœ“ unlocking slot clears winner reference (17 ms)
    Edge Cases
      âœ“ slot with mixed active and pending clips stays in voting (35 ms)
      âœ“ rejected clips do not count towards slot status (25 ms)

Test Suites: 6 passed, 6 total
Tests:       90 passed, 90 total
Snapshots:   0 total
Time:        4.837 s, estimated 7 s
Ran all test suites.
